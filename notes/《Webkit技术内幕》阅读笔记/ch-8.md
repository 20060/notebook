## 硬件加速机制

### 为什么使用部分CSS 3D旋转的样式会触发硬件加速
> 为什么硬件加速会导致页面变得流畅

理想情况下：页面是通过一个`RenderLayer`对象进行与最终显示的图形进行一一对应，每一个`RenderLayer`对象都有一个对应的后端存储。  
这样，在有些元素进行更新时，只需要修改某个`RenderLayer`对应的节点即可完成更新。  

但是硬件资源是有限的，浏览器并不能针对每一个`RenderLayer`对象都设置对应的后端存储。  
所以浏览器会将一些`RenderLayer`对象合并到一起，并创建一个后端存储。  
这个合成后的组合被称为合成层。  

所以说，只有合成层中的`RenderLayer`才拥有自己独立的后端存储。  
而关于合成层的定义，有如下几个特征：
- 具有CSS 3D属性或者CSS透视效果
- 节点中包含video标签
- 节点中包含使用了canvas或者webgl的元素
- 使用了CSS透明效果的动画或者CSS转换的动画
- 使用了CSS Filters技术
- 使用了裁剪（Clip）或者反射（Reflection）属性，并且子元素中包含一个合成层
- 包含一个Z坐标比自己小的兄弟节点，且该节点是一个合成层

> 后两个因为可能会对内部的合成层造成覆盖之类的影响，所以这就决定了他们也一定是合成层（个人理解）  

所以这决定了为什么使用CSS 3D效果可以启用硬件加速。  
而为什么又建议只在部分元素上使用该特性呢，就是因为每一个合成层都会占据部分存储空间（可以理解为内存），所以合成层多了依然会导致设备卡顿。


### 为什么使用CSS 3D属性会导致页面开启硬件加速

浏览器在渲染页面时，会针对节点创建对应的渲染对象，理想情况下每一个对象都有对应的后端存储来记录节点信息（存储在GPU内存中），这样我们在更新页面时，仅仅需要更新该对象对应的节点即可完成。  
然而后端存储是很耗费资源的，所以浏览器不会针对每一个渲染对象创建后端存储，而是将一些渲染对象进行合并分组，并针对这个组创建一个后端存储用来记录节点信息。这个被称为合成层。  

而使用CSS 3D属性会导致浏览器针对该节点创建合成层，所以该节点就会有自己的后端存储，对应的也就开启了硬件加速，这也是为什么开启硬件加速后会导致页面流畅度提升（因为更新页面仅仅会更新这一个小的合成层，而不会去外层的合成层查找）  

### 为什么不建议滥用硬件加速

就像上边说的，每一个合成层的后端存储都是存放在GPU的内存中的，滥用硬件加速，创建大量的合成层就会导致内存的使用增加。（说手机上会导致耗电加速应该也就是这个原因了）